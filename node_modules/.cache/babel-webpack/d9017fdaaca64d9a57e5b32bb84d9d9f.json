{"ast":null,"code":"import { from } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { assign, cloneDeep } from 'lodash-es';\nimport { FuseMockApiUtils } from '@fuse/lib/mock-api';\nimport { contacts as contactsData, countries as countriesData, tags as tagsData } from 'app/mock-api/apps/contacts/data';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@fuse/lib/mock-api\";\nexport let ContactsMockApi = /*#__PURE__*/(() => {\n  class ContactsMockApi {\n    /**\r\n     * Constructor\r\n     */\n    constructor(_fuseMockApiService) {\n      this._fuseMockApiService = _fuseMockApiService;\n      this._contacts = contactsData;\n      this._countries = countriesData;\n      this._tags = tagsData;\n      // Register Mock API handlers\n      this.registerHandlers();\n    }\n    // -----------------------------------------------------------------------------------------------------\n    // @ Public methods\n    // -----------------------------------------------------------------------------------------------------\n    /**\r\n     * Register Mock API handlers\r\n     */\n    registerHandlers() {\n      // -----------------------------------------------------------------------------------------------------\n      // @ Contacts - GET\n      // -----------------------------------------------------------------------------------------------------\n      this._fuseMockApiService.onGet('api/apps/contacts/all').reply(() => {\n        // Clone the contacts\n        const contacts = cloneDeep(this._contacts);\n        // Sort the contacts by the name field by default\n        contacts.sort((a, b) => a.name.localeCompare(b.name));\n        // Return the response\n        return [200, contacts];\n      });\n      // -----------------------------------------------------------------------------------------------------\n      // @ Contacts Search - GET\n      // -----------------------------------------------------------------------------------------------------\n      this._fuseMockApiService.onGet('api/apps/contacts/search').reply(({\n        request\n      }) => {\n        // Get the search query\n        const query = request.params.get('query');\n        // Clone the contacts\n        let contacts = cloneDeep(this._contacts);\n        // If the query exists...\n        if (query) {\n          // Filter the contacts\n          contacts = contacts.filter(contact => contact.name && contact.name.toLowerCase().includes(query.toLowerCase()));\n        }\n        // Sort the contacts by the name field by default\n        contacts.sort((a, b) => a.name.localeCompare(b.name));\n        // Return the response\n        return [200, contacts];\n      });\n      // -----------------------------------------------------------------------------------------------------\n      // @ Contact - GET\n      // -----------------------------------------------------------------------------------------------------\n      this._fuseMockApiService.onGet('api/apps/contacts/contact').reply(({\n        request\n      }) => {\n        // Get the id from the params\n        const id = request.params.get('id');\n        // Clone the contacts\n        const contacts = cloneDeep(this._contacts);\n        // Find the contact\n        const contact = contacts.find(item => item.id === id);\n        // Return the response\n        return [200, contact];\n      });\n      // -----------------------------------------------------------------------------------------------------\n      // @ Contact - POST\n      // -----------------------------------------------------------------------------------------------------\n      this._fuseMockApiService.onPost('api/apps/contacts/contact').reply(() => {\n        // Generate a new contact\n        const newContact = {\n          id: FuseMockApiUtils.guid(),\n          avatar: null,\n          name: 'New Contact',\n          emails: [],\n          phoneNumbers: [],\n          job: {\n            title: '',\n            company: ''\n          },\n          birthday: null,\n          address: null,\n          notes: null,\n          tags: []\n        };\n        // Unshift the new contact\n        this._contacts.unshift(newContact);\n        // Return the response\n        return [200, newContact];\n      });\n      // -----------------------------------------------------------------------------------------------------\n      // @ Contact - PATCH\n      // -----------------------------------------------------------------------------------------------------\n      this._fuseMockApiService.onPatch('api/apps/contacts/contact').reply(({\n        request\n      }) => {\n        // Get the id and contact\n        const id = request.body.id;\n        const contact = cloneDeep(request.body.contact);\n        // Prepare the updated contact\n        let updatedContact = null;\n        // Find the contact and update it\n        this._contacts.forEach((item, index, contacts) => {\n          if (item.id === id) {\n            // Update the contact\n            contacts[index] = assign({}, contacts[index], contact);\n            // Store the updated contact\n            updatedContact = contacts[index];\n          }\n        });\n        // Return the response\n        return [200, updatedContact];\n      });\n      // -----------------------------------------------------------------------------------------------------\n      // @ Contact - DELETE\n      // -----------------------------------------------------------------------------------------------------\n      this._fuseMockApiService.onDelete('api/apps/contacts/contact').reply(({\n        request\n      }) => {\n        // Get the id\n        const id = request.params.get('id');\n        // Find the contact and delete it\n        this._contacts.forEach((item, index) => {\n          if (item.id === id) {\n            this._contacts.splice(index, 1);\n          }\n        });\n        // Return the response\n        return [200, true];\n      });\n      // -----------------------------------------------------------------------------------------------------\n      // @ Countries - GET\n      // -----------------------------------------------------------------------------------------------------\n      this._fuseMockApiService.onGet('api/apps/contacts/countries').reply(() => [200, cloneDeep(this._countries)]);\n      // -----------------------------------------------------------------------------------------------------\n      // @ Tags - GET\n      // -----------------------------------------------------------------------------------------------------\n      this._fuseMockApiService.onGet('api/apps/contacts/tags').reply(() => [200, cloneDeep(this._tags)]);\n      // -----------------------------------------------------------------------------------------------------\n      // @ Tags - POST\n      // -----------------------------------------------------------------------------------------------------\n      this._fuseMockApiService.onPost('api/apps/contacts/tag').reply(({\n        request\n      }) => {\n        // Get the tag\n        const newTag = cloneDeep(request.body.tag);\n        // Generate a new GUID\n        newTag.id = FuseMockApiUtils.guid();\n        // Unshift the new tag\n        this._tags.unshift(newTag);\n        // Return the response\n        return [200, newTag];\n      });\n      // -----------------------------------------------------------------------------------------------------\n      // @ Tags - PATCH\n      // -----------------------------------------------------------------------------------------------------\n      this._fuseMockApiService.onPatch('api/apps/contacts/tag').reply(({\n        request\n      }) => {\n        // Get the id and tag\n        const id = request.body.id;\n        const tag = cloneDeep(request.body.tag);\n        // Prepare the updated tag\n        let updatedTag = null;\n        // Find the tag and update it\n        this._tags.forEach((item, index, tags) => {\n          if (item.id === id) {\n            // Update the tag\n            tags[index] = assign({}, tags[index], tag);\n            // Store the updated tag\n            updatedTag = tags[index];\n          }\n        });\n        // Return the response\n        return [200, updatedTag];\n      });\n      // -----------------------------------------------------------------------------------------------------\n      // @ Tag - DELETE\n      // -----------------------------------------------------------------------------------------------------\n      this._fuseMockApiService.onDelete('api/apps/contacts/tag').reply(({\n        request\n      }) => {\n        // Get the id\n        const id = request.params.get('id');\n        // Find the tag and delete it\n        this._tags.forEach((item, index) => {\n          if (item.id === id) {\n            this._tags.splice(index, 1);\n          }\n        });\n        // Get the contacts that have the tag\n        const contactsWithTag = this._contacts.filter(contact => contact.tags.indexOf(id) > -1);\n        // Iterate through them and delete the tag\n        contactsWithTag.forEach(contact => {\n          contact.tags.splice(contact.tags.indexOf(id), 1);\n        });\n        // Return the response\n        return [200, true];\n      });\n      // -----------------------------------------------------------------------------------------------------\n      // @ Avatar - POST\n      // -----------------------------------------------------------------------------------------------------\n      /**\r\n       * Read the given file as mock-api url\r\n       *\r\n       * @param file\r\n       */\n      const readAsDataURL = file =>\n      // Return a new promise\n      new Promise((resolve, reject) => {\n        // Create a new reader\n        const reader = new FileReader();\n        // Resolve the promise on success\n        reader.onload = () => {\n          resolve(reader.result);\n        };\n        // Reject the promise on error\n        reader.onerror = e => {\n          reject(e);\n        };\n        // Read the file as the\n        reader.readAsDataURL(file);\n      });\n      this._fuseMockApiService.onPost('api/apps/contacts/avatar').reply(({\n        request\n      }) => {\n        // Get the id and avatar\n        const id = request.body.id;\n        const avatar = request.body.avatar;\n        // Prepare the updated contact\n        let updatedContact = null;\n        // In a real world application, this would return the path\n        // of the saved image file (from host, S3 bucket, etc.) but,\n        // for the sake of the demo, we encode the image to base64\n        // and return it as the new path of the uploaded image since\n        // the src attribute of the img tag works with both image urls\n        // and encoded images.\n        return from(readAsDataURL(avatar)).pipe(map(path => {\n          // Find the contact and update it\n          this._contacts.forEach((item, index, contacts) => {\n            if (item.id === id) {\n              // Update the avatar\n              contacts[index].avatar = path;\n              // Store the updated contact\n              updatedContact = contacts[index];\n            }\n          });\n          // Return the response\n          return [200, updatedContact];\n        }));\n      });\n    }\n  }\n  ContactsMockApi.ɵfac = function ContactsMockApi_Factory(t) {\n    return new (t || ContactsMockApi)(i0.ɵɵinject(i1.FuseMockApiService));\n  };\n  ContactsMockApi.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: ContactsMockApi,\n    factory: ContactsMockApi.ɵfac,\n    providedIn: 'root'\n  });\n  return ContactsMockApi;\n})();","map":null,"metadata":{},"sourceType":"module"}