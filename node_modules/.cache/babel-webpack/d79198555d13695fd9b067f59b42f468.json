{"ast":null,"code":"import { assign, cloneDeep } from 'lodash-es';\nimport { FuseMockApiUtils } from '@fuse/lib/mock-api';\nimport { boards as boardsData, cards as cardsData, labels as labelsData, lists as listsData, members as membersData } from 'app/mock-api/apps/scrumboard/data';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@fuse/lib/mock-api\";\nexport let ScrumboardMockApi = /*#__PURE__*/(() => {\n  class ScrumboardMockApi {\n    /**\r\n     * Constructor\r\n     */\n    constructor(_fuseMockApiService) {\n      this._fuseMockApiService = _fuseMockApiService;\n      // Private\n      this._boards = boardsData;\n      this._cards = cardsData;\n      this._labels = labelsData;\n      this._lists = listsData;\n      this._members = membersData;\n      // Register Mock API handlers\n      this.registerHandlers();\n    }\n    // -----------------------------------------------------------------------------------------------------\n    // @ Public methods\n    // -----------------------------------------------------------------------------------------------------\n    /**\r\n     * Register Mock API handlers\r\n     */\n    registerHandlers() {\n      // -----------------------------------------------------------------------------------------------------\n      // @ Boards - GET\n      // -----------------------------------------------------------------------------------------------------\n      this._fuseMockApiService.onGet('api/apps/scrumboard/boards').reply(({\n        request\n      }) => {\n        // Clone the boards\n        let boards = cloneDeep(this._boards);\n        // Go through the boards and inject the members\n        boards = boards.map(board => Object.assign(Object.assign({}, board), {\n          members: board.members.map(boardMember => this._members.find(member => boardMember === member.id))\n        }));\n        return [200, boards];\n      });\n      // -----------------------------------------------------------------------------------------------------\n      // @ Board - GET\n      // -----------------------------------------------------------------------------------------------------\n      this._fuseMockApiService.onGet('api/apps/scrumboard/board').reply(({\n        request\n      }) => {\n        // Get the id\n        const id = request.params.get('id');\n        // Find the board\n        const board = this._boards.find(item => item.id === id);\n        // Attach the board lists\n        board.lists = this._lists.filter(item => item.boardId === id).sort((a, b) => a.position - b.position);\n        // Grab all cards that belong to this board and attach labels to them\n        let cards = this._cards.filter(item => item.boardId === id);\n        cards = cards.map(card => Object.assign(Object.assign({}, card), {\n          labels: card.labels.map(cardLabelId => this._labels.find(label => label.id === cardLabelId))\n        }));\n        // Attach the board cards into corresponding lists\n        board.lists.forEach((list, index, array) => {\n          array[index].cards = cards.filter(item => item.boardId === id && item.listId === list.id).sort((a, b) => a.position - b.position);\n        });\n        // Attach the board labels\n        board.labels = this._labels.filter(item => item.boardId === id);\n        return [200, cloneDeep(board)];\n      });\n      // -----------------------------------------------------------------------------------------------------\n      // @ List - POST\n      // -----------------------------------------------------------------------------------------------------\n      this._fuseMockApiService.onPost('api/apps/scrumboard/board/list').reply(({\n        request\n      }) => {\n        // Get the list\n        const newList = cloneDeep(request.body.list);\n        // Generate a new GUID\n        newList.id = FuseMockApiUtils.guid();\n        // Store the new list\n        this._lists.push(newList);\n        return [200, newList];\n      });\n      // -----------------------------------------------------------------------------------------------------\n      // @ List - PATCH\n      // -----------------------------------------------------------------------------------------------------\n      this._fuseMockApiService.onPatch('api/apps/scrumboard/board/list').reply(({\n        request\n      }) => {\n        // Get the list\n        const list = cloneDeep(request.body.list);\n        // Prepare the updated list\n        let updatedList = null;\n        // Find the list and update it\n        this._lists.forEach((item, index, lists) => {\n          if (item.id === list.id) {\n            // Update the list\n            lists[index] = assign({}, lists[index], list);\n            // Store the updated list\n            updatedList = lists[index];\n          }\n        });\n        return [200, updatedList];\n      });\n      // -----------------------------------------------------------------------------------------------------\n      // @ Lists - PATCH\n      // -----------------------------------------------------------------------------------------------------\n      this._fuseMockApiService.onPatch('api/apps/scrumboard/board/lists').reply(({\n        request\n      }) => {\n        // Get the lists\n        const lists = cloneDeep(request.body.lists);\n        // Prepare the updated lists\n        const updatedLists = [];\n        // Go through the lists\n        lists.forEach(item => {\n          // Find the list\n          const index = this._lists.findIndex(list => item.id === list.id);\n          // Update the list\n          this._lists[index] = assign({}, this._lists[index], item);\n          // Store in the updated lists\n          updatedLists.push(item);\n        });\n        return [200, updatedLists];\n      });\n      // -----------------------------------------------------------------------------------------------------\n      // @ List - DELETE\n      // -----------------------------------------------------------------------------------------------------\n      this._fuseMockApiService.onDelete('api/apps/scrumboard/board/list').reply(({\n        request\n      }) => {\n        // Get the id\n        const id = request.params.get('id');\n        // Find the list and delete it\n        const index = this._lists.findIndex(item => item.id === id);\n        this._lists.splice(index, 1);\n        // Filter out the cards that belonged to the list to delete them\n        this._cards = this._cards.filter(card => card.listId !== id);\n        return [200, true];\n      });\n      // -----------------------------------------------------------------------------------------------------\n      // @ Card - PUT\n      // -----------------------------------------------------------------------------------------------------\n      this._fuseMockApiService.onPut('api/apps/scrumboard/board/card').reply(({\n        request\n      }) => {\n        // Get the card\n        const newCard = cloneDeep(request.body.card);\n        // Generate a new GUID\n        newCard.id = FuseMockApiUtils.guid();\n        // Unshift the new card\n        this._cards.push(newCard);\n        return [200, newCard];\n      });\n      // -----------------------------------------------------------------------------------------------------\n      // @ Card - PATCH\n      // -----------------------------------------------------------------------------------------------------\n      this._fuseMockApiService.onPatch('api/apps/scrumboard/board/card').reply(({\n        request\n      }) => {\n        // Get the id and card\n        const id = request.body.id;\n        const card = cloneDeep(request.body.card);\n        // Prepare the updated card\n        let updatedCard = null;\n        // Go through the labels and leave only ids of them\n        card.labels = card.labels.map(itemLabel => itemLabel.id);\n        // Find the card and update it\n        this._cards.forEach((item, index, cards) => {\n          if (item.id === id) {\n            // Update the card\n            cards[index] = assign({}, cards[index], card);\n            // Store the updated card\n            updatedCard = cloneDeep(cards[index]);\n          }\n        });\n        // Attach the labels of the card\n        updatedCard.labels = updatedCard.labels.map(cardLabelId => this._labels.find(label => label.id === cardLabelId));\n        return [200, updatedCard];\n      });\n      // -----------------------------------------------------------------------------------------------------\n      // @ Cards - PATCH\n      // -----------------------------------------------------------------------------------------------------\n      this._fuseMockApiService.onPatch('api/apps/scrumboard/board/cards').reply(({\n        request\n      }) => {\n        // Get the cards\n        const cards = cloneDeep(request.body.cards);\n        // Prepare the updated cards\n        const updatedCards = [];\n        // Go through the cards\n        cards.forEach(item => {\n          // Find the card\n          const index = this._cards.findIndex(card => item.id === card.id);\n          // Go through the labels and leave only ids of them\n          item.labels = item.labels.map(itemLabel => itemLabel.id);\n          // Update the card\n          this._cards[index] = assign({}, this._cards[index], item);\n          // Attach the labels of the card\n          item.labels = item.labels.map(cardLabelId => this._labels.find(label => label.id === cardLabelId));\n          // Store in the updated cards\n          updatedCards.push(item);\n        });\n        return [200, updatedCards];\n      });\n      // -----------------------------------------------------------------------------------------------------\n      // @ Card - DELETE\n      // -----------------------------------------------------------------------------------------------------\n      this._fuseMockApiService.onDelete('api/apps/scrumboard/board/card').reply(({\n        request\n      }) => {\n        // Get the id\n        const id = request.params.get('id');\n        // Find the card and delete it\n        const index = this._cards.findIndex(item => item.id === id);\n        this._cards.splice(index, 1);\n        return [200, true];\n      });\n      // -----------------------------------------------------------------------------------------------------\n      // @ Card Positions - PATCH\n      // -----------------------------------------------------------------------------------------------------\n      this._fuseMockApiService.onPatch('api/apps/scrumboard/board/card/positions').reply(({\n        request\n      }) => {\n        // Get the cards\n        const cards = request.body.cards;\n        // Go through the cards\n        this._cards.forEach(card => {\n          // Find this card's index within the cards array that comes with the request\n          // and assign that index as the new position number for the card\n          card.position = cards.findIndex(item => item.id === card.id && item.listId === card.listId && item.boardId === card.boardId);\n        });\n        // Clone the cards\n        const updatedCards = cloneDeep(this._cards);\n        return [200, updatedCards];\n      });\n      // -----------------------------------------------------------------------------------------------------\n      // @ Labels - GET\n      // -----------------------------------------------------------------------------------------------------\n      this._fuseMockApiService.onGet('api/apps/scrumboard/board/labels').reply(({\n        request\n      }) => {\n        // Get the board id\n        const boardId = request.params.get('boardId');\n        // Filter the labels\n        const labels = this._labels.filter(item => item.boardId === boardId);\n        return [200, cloneDeep(labels)];\n      });\n      // -----------------------------------------------------------------------------------------------------\n      // @ Label - PUT\n      // -----------------------------------------------------------------------------------------------------\n      this._fuseMockApiService.onPut('api/apps/scrumboard/board/label').reply(({\n        request\n      }) => {\n        // Get the label\n        const newLabel = cloneDeep(request.body.label);\n        // Generate a new GUID\n        newLabel.id = FuseMockApiUtils.guid();\n        // Unshift the new label\n        this._labels.unshift(newLabel);\n        return [200, newLabel];\n      });\n      // -----------------------------------------------------------------------------------------------------\n      // @ Label - PATCH\n      // -----------------------------------------------------------------------------------------------------\n      this._fuseMockApiService.onPatch('api/apps/scrumboard/board/label').reply(({\n        request\n      }) => {\n        // Get the id and label\n        const id = request.body.id;\n        const label = cloneDeep(request.body.label);\n        // Prepare the updated label\n        let updatedLabel = null;\n        // Find the label and update it\n        this._labels.forEach((item, index, labels) => {\n          if (item.id === id) {\n            // Update the label\n            labels[index] = assign({}, labels[index], label);\n            // Store the updated label\n            updatedLabel = labels[index];\n          }\n        });\n        return [200, updatedLabel];\n      });\n      // -----------------------------------------------------------------------------------------------------\n      // @ Label - DELETE\n      // -----------------------------------------------------------------------------------------------------\n      this._fuseMockApiService.onDelete('api/apps/scrumboard/board/label').reply(({\n        request\n      }) => {\n        // Get the id\n        const id = request.params.get('id');\n        // Find the label and delete it\n        const index = this._labels.findIndex(item => item.id === id);\n        this._labels.splice(index, 1);\n        // Get the cards that have the label\n        const cardsWithLabel = this._cards.filter(card => card.labels.indexOf(id) > -1);\n        // Iterate through them and remove the label\n        cardsWithLabel.forEach(card => {\n          card.tags.splice(card.tags.indexOf(id), 1);\n        });\n        return [200, true];\n      });\n    }\n  }\n  ScrumboardMockApi.ɵfac = function ScrumboardMockApi_Factory(t) {\n    return new (t || ScrumboardMockApi)(i0.ɵɵinject(i1.FuseMockApiService));\n  };\n  ScrumboardMockApi.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: ScrumboardMockApi,\n    factory: ScrumboardMockApi.ɵfac,\n    providedIn: 'root'\n  });\n  return ScrumboardMockApi;\n})();","map":null,"metadata":{},"sourceType":"module"}